<!DOCTYPE html>
<meta charset='UTF-8'>
<title>VAW Concertina</title>

<link href='https://cdnjs.cloudflare.com/ajax/libs/normalize/4.0.0/normalize.min.css' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Roboto|Roboto+Condensed' rel='stylesheet' type='text/css'>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js'></script>

<script src='https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js'></script>

<link href='styles.css' rel='stylesheet' type='text/css'>
<script src='timeline.js'></script>

<div id='header'><img src='images/tackling_violence_roundel.jpg'/></div>

<div id='icons'>
<img src='images/commitee.jpg'/>
<img src='images/court_case.jpg'/>
<img src='images/declaration.jpg'/>
<img src='images/judicial_mech.jpg'/>
<img src='images/treaty.jpg'/>
<img src='images/special_rapporteur.jpg'/>
</div>

<div id='timeline' class='accordion'></div>

<script>

  // fetch and visualize data
  d3.csv('data.csv', function(err, data) {
    if(err) throw err

    type(data)

    let nest = d3.nest()
      .key(function(d) { return d.period })
      .sortKeys(function(a,b) { return d3.ascending(period_start(a, data), period_start(b, data)) })
      .entries(data)

    let section = d3.select('#timeline').selectAll('section')
        .data(nest)
      .enter().append('section')
        .attr('class', 'period')

    section.append('h2')
        .html(function(d) { return d.key })

    let entry = section.append('ul').selectAll('li')
          .data( function(d) { return d.values })
        .enter().append('li')

    entry.append('div').attr('class', 'banner')
         .append('div').attr('class', 'year')
      .html( function(d) { return d.year })
    entry.append('h4').html( function(d) { return d.title })
    entry.append('p').html( function(d) { return d.text })
  })


  // accordion effect
  $('.period h2').click( function() {
    $(this).next().slideToggle()
  })


  // convert ajax data file to javascript types
  function type(data) {
    data.forEach(function(d) {
      d.year = +d.year
    })
  }

  // determine when a named period started
  function period_start(name, data) {
    let i = d3.min(data.map(function(d) { return d.period === name ? d.year : Infinity }))
    return i
  }
</script>